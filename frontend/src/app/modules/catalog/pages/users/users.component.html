<div class="container-fluid">

  <h1 class="h2">{{ 'CAT.SIDEBAR.USERS' | translate }}</h1>

  <div class="row">
    <div class="col-lg-3 col-md-6 col-sm-6 col-12 p-2">
        <div class="small-box text-bg-primary">
            <div class="inner">
                <h3 *ngIf="usersStats$ | async as stats">{{ stats.todayLoans }}</h3>
                <p>{{ 'CAT.STATS.LENDINGS_COUNT_TODAY' | translate }}</p>
            </div>
            <i class="bi bi-bookmark-check small-box-icon"></i>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 col-sm-6 col-12 p-2">
        <div class="small-box text-bg-success">
            <div class="inner">
                <h3 *ngIf="usersStats$ | async as stats">{{ stats.activeUsersThisMonth }}</h3>
                <p>{{ 'CAT.STATS.USERS_ACTIVE_THIS_MONTH' | translate }}</p>
            </div>
            <i class="bi bi-activity small-box-icon"></i>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 col-sm-6 col-12 p-2">
        <div class="small-box text-bg-warning">
            <div class="inner">
                <h3 *ngIf="usersStats$ | async as stats">{{ stats.newUsersThisMonth }}</h3>
                <p>{{ 'CAT.STATS.USERS_NEW_THIS_MONTH' | translate }}</p>
            </div>
            <i class="bi bi-person-plus-fill small-box-icon"></i>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 col-sm-6 col-12 p-2">
        <div class="small-box text-bg-danger">
            <div class="inner">
                <h3 *ngIf="usersStats$ | async as stats">{{ stats.usersCount }}</h3>
                <p>{{ 'CAT.STATS.USERS_TOTAL' | translate }}</p>
            </div>
            <i class="bi bi-people-fill small-box-icon"></i>
        </div>
    </div>
  </div>
  
  <div class="row">

    <div class="col-12 col-sm-2 col-md-2 col-lg-2 col-xl-1 p-2" type="button" data-bs-toggle="modal" data-bs-target="#registrationModal" (click)="generateFakeUsers()">
      <div class="small-box add-user-btn">
        <i class="bi bi-person-add small-box-icon"></i>
      </div>
    </div>

    <app-basic-section class="col-12 col-sm-10 col-md-10 col-lg-10 col-xl-5 col-xxl-5" [name]="'CAT.USER.ACCOUNT.LENDINGS_WEEKLY' | translate">
      <app-weekly-activity-chart
        *ngIf="usersStats$ | async as stats; else lack"
        [data1]="stats.newLoansLastWeekByDay"
        [data2]="stats.returnedLoansLastWeekByDay"
      ></app-weekly-activity-chart>
    </app-basic-section>

    <app-basic-section class="col-md-6 col-sm-12 col-12 col-xxl-3" [name]="'CAT.USER.ACCOUNT.LENDINGS_ANNUAL' | translate">
      <app-annual-activity-chart
        *ngIf="usersStats$ | async as stats; else lack"
        [data]="stats.loansLastYearByMonth"
      ></app-annual-activity-chart>
    </app-basic-section>

    <app-basic-section class="col-md-6 col-sm-12 col-12 col-xxl-3" [name]="'CAT.USER.ACCOUNT.FAV_GENRES' | translate">
      <app-fav-genre-chart
        *ngIf="usersStats$ | async as stats; else lack"
        [data]="stats.favGenres"
      ></app-fav-genre-chart>
    </app-basic-section>
  
    <app-basic-section class="col-12 col-xl-6 col-xxl-6" [name]="'CAT.STATS.USERS_TOTAL' | translate">
      <app-table
        *ngIf="usersPage && usersPage.content; else lack"
        [tableName]="'user-list'"
        [columns]="[
            { key: 'id', label: 'CAT.USER.ACCOUNT.ID' },
            { key: 'firstName', label: 'CAT.USER.DETAILS.FIRST_NAME' },
            { key: 'lastName', label: 'CAT.USER.DETAILS.LAST_NAME' },
            { key: 'email', label: 'CAT.USER.ACCOUNT.EMAIL' },
            { key: 'registrationDate', label: 'CAT.USER.ACCOUNT.DATE_OF_REGISTRATION', type: 'date' },
        ]"
        [data]="usersPage.content || []"
        [page]="usersPage"
        (onUpdate)="updateTable($event)"
        (onRowClick)="showDetails($event)"
      ></app-table>
    </app-basic-section>

    <app-basic-section class="col-12 col-xl-6 col-xxl-3" [name]="'CAT.STATS.USERS_TOP_BORROWERS' | translate">
      <app-top-borrowers
        *ngIf="usersStats$ | async as stats; else lack"
        [columns]="[
            { key: 'rank', label: 'CAT.STATS.RANK' },
            { key: 'fullName', label: 'CAT.USER.BORROWER' },
            { key: 'totalBooksBorrowed', label: 'CAT.USER.ACCOUNT.LENDINGS' },
        ]"
        [data]="stats.topBorrowers || []"
        (onRowClick)="showDetails($event)"
      ></app-top-borrowers>
    </app-basic-section>

    <app-basic-section class="col-md-6 col-sm-12 col-12 col-xxl-3" [name]="'CAT.STATS.USERS_AGE_GROUPS.HEADER' | translate">
      <app-users-age-groups-chart
        *ngIf="usersStats$ | async as stats; else lack"
        [data]="stats.ageGroups"
      ></app-users-age-groups-chart>
    </app-basic-section>

    <app-basic-section class="col-md-6 col-sm-12 col-12 col-xxl-3" [name]="'CAT.STATS.USERS_TOP_CITIES' | translate">
      <app-top-cities
        *ngIf="usersStats$ | async as stats; else lack"
        [columns]="[
            'CAT.USER.DETAILS.CITY' ,
            'CAT.STATS.AMOUNT' ,
        ]"
        [data]="stats.topCities"
      ></app-top-cities>
    </app-basic-section>
</div>


<ng-template #lack>{{ 'DATA.LACK' | translate }}</ng-template>

<app-registration-form></app-registration-form>  